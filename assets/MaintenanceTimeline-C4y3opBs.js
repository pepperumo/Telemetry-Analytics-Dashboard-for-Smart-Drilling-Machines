import{j as r,V as y,U as e,W as U,$,a0 as I,a1 as K,_ as q}from"./index-DkNXKMsf.js";import{B as H,a as u}from"./BarChart-ai-nNWAX.js";const z=({className:j=""})=>{const[f,D]=r.useState([]),[b,C]=r.useState([]),[A,v]=r.useState(!0),[N,_]=r.useState(null),[m,w]=r.useState(new Set),[x,E]=r.useState(new Set(["critical","high","medium","low"])),[k,T]=r.useState(new Set),[c,M]=r.useState(30),[h,F]=r.useState(!1),[i,g]=r.useState(null);r.useEffect(()=>{p()},[]);const p=async()=>{v(!0),_(null);try{const[s,a]=await Promise.all([y.getAlerts({status:h?void 0:"active",per_page:100}),y.getHealthScores()]);D(s.alerts),C(a.health_scores);const t=new Set(s.alerts.map(o=>o.device_id)),n=new Set(s.alerts.map(o=>o.alert_type));w(t),T(n)}catch(s){_(s instanceof Error?s.message:"Failed to load maintenance data"),console.error("Failed to load maintenance data:",s)}finally{v(!1)}},d=r.useMemo(()=>{const s=new Date,a=new Map(b.map(t=>[t.device_id,t.health_score]));return f.filter(t=>!(!m.has(t.device_id)||!x.has(t.severity)||!k.has(t.alert_type)||!h&&t.status==="acknowledged")).map(t=>{let n;if(t.predicted_failure_time)n=new Date(t.predicted_failure_time);else{const P={critical:3,high:7,medium:14,low:30}[t.severity];n=new Date(s.getTime()+P*24*60*60*1e3)}const o=Math.ceil((n.getTime()-s.getTime())/(1440*60*1e3));return{id:t.id,device_id:t.device_id,title:t.title,description:t.description,severity:t.severity,alert_type:t.alert_type,status:t.status,predicted_date:n,confidence_score:t.confidence_score,recommended_actions:t.recommended_actions,affected_systems:t.affected_systems,created_at:new Date(t.created_at),acknowledged_at:t.acknowledged_at?new Date(t.acknowledged_at):void 0,health_score:a.get(t.device_id),timeline_position:o}}).filter(t=>t.timeline_position<=c&&t.timeline_position>=0).sort((t,n)=>t.timeline_position-n.timeline_position)},[f,b,m,x,k,c,h]),R=r.useMemo(()=>{const s=new Map,a=new Date;for(let t=0;t<=c;t++){const n=new Date(a.getTime()+t*24*60*60*1e3);s.set(t,{date:n.toLocaleDateString(),day_offset:t,critical_events:0,high_events:0,medium_events:0,low_events:0,total_events:0,events:[]})}return d.forEach(t=>{const n=s.get(t.timeline_position);n&&(n.events.push(t),n.total_events++,n[`${t.severity}_events`]++)}),Array.from(s.values())},[d,c]),S=async s=>{try{await y.quickAcknowledgeAlert(s.id,"Dashboard User")&&(await p(),g(null))}catch(a){console.error("Failed to acknowledge alert:",a)}},l={critical:"#ef4444",high:"#f97316",medium:"#eab308",low:"#22c55e"},L={performance_degradation:"ðŸ“‰",equipment_failure_risk:"âš ï¸",battery_maintenance:"ðŸ”‹",mechanical_wear:"âš™ï¸",thermal_stress:"ðŸŒ¡ï¸",electrical_anomaly:"âš¡"};return A?e.jsxs("div",{className:`bg-white rounded-lg shadow-md p-6 border border-gray-200 ${j}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Predictive Maintenance Timeline"}),e.jsx("div",{className:"h-80 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Loading maintenance predictions..."})]})})]}):N?e.jsxs("div",{className:`bg-white rounded-lg shadow-md p-6 border border-gray-200 ${j}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Predictive Maintenance Timeline"}),e.jsx("div",{className:"h-80 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-red-600",children:[e.jsx("p",{className:"text-lg font-medium mb-2",children:"âš ï¸ Error Loading Data"}),e.jsx("p",{className:"text-sm",children:N}),e.jsx("button",{onClick:p,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Retry"})]})})]}):e.jsxs("div",{className:`bg-white rounded-lg shadow-md p-6 border border-gray-200 ${j}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Predictive Maintenance Timeline"}),e.jsx("button",{onClick:p,className:"text-sm px-3 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:"ðŸ”„ Refresh"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Equipment Filter:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from(new Set(f.map(s=>s.device_id))).map(s=>e.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.has(s),onChange:a=>{const t=new Set(m);a.target.checked?t.add(s):t.delete(s),w(t)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm",children:s})]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Severity Filter:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["critical","high","medium","low"].map(s=>e.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.has(s),onChange:a=>{const t=new Set(x);a.target.checked?t.add(s):t.delete(s),E(t)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium px-2 py-1 rounded",style:{backgroundColor:l[s]+"20",color:l[s]},children:s.toUpperCase()})]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Range:"}),e.jsxs("select",{value:c,onChange:s=>M(Number(s.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:7,children:"Next 7 Days"}),e.jsx("option",{value:14,children:"Next 2 Weeks"}),e.jsx("option",{value:30,children:"Next 30 Days"}),e.jsx("option",{value:60,children:"Next 60 Days"}),e.jsx("option",{value:90,children:"Next 90 Days"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Options:"}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:s=>F(s.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm",children:"Include Acknowledged Alerts"})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:Object.entries(l).map(([s,a])=>{const t=d.filter(n=>n.severity===s).length;return e.jsxs("div",{className:"p-3 rounded-lg border-l-4",style:{borderColor:a},children:[e.jsx("div",{className:"text-sm font-medium text-gray-600",children:s.toUpperCase()}),e.jsx("div",{className:"text-xl font-bold",style:{color:a},children:t})]},s)})}),e.jsxs("div",{className:"h-64 mb-6",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:["Maintenance Events Distribution (Next ",c," Days)"]}),e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(H,{data:R,children:[e.jsx($,{strokeDasharray:"3 3"}),e.jsx(I,{dataKey:"date",tick:{fontSize:10},angle:-45,textAnchor:"end",height:60}),e.jsx(K,{label:{value:"Events",angle:-90,position:"insideLeft"}}),e.jsx(q,{formatter:(s,a)=>[s,a.replace("_events","").toUpperCase()],labelFormatter:s=>`Date: ${s}`}),e.jsx(u,{dataKey:"critical_events",stackId:"a",fill:l.critical}),e.jsx(u,{dataKey:"high_events",stackId:"a",fill:l.high}),e.jsx(u,{dataKey:"medium_events",stackId:"a",fill:l.medium}),e.jsx(u,{dataKey:"low_events",stackId:"a",fill:l.low})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700",children:["Upcoming Maintenance Events (",d.length,")"]}),d.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"ðŸŽ‰ No maintenance events scheduled"}),e.jsx("p",{className:"text-sm",children:"All equipment is operating within normal parameters."})]}):e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:d.map(s=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-gray-50 cursor-pointer transition-colors border-l-4",style:{borderLeftColor:l[s.severity]},onClick:()=>g(s),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:"text-lg",children:L[s.alert_type]}),e.jsx("span",{className:"font-medium text-gray-900",children:s.title}),e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium",style:{backgroundColor:l[s.severity]+"20",color:l[s.severity]},children:s.severity.toUpperCase()}),s.status==="acknowledged"&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded text-xs",children:"âœ“ ACKNOWLEDGED"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Device:"})," ",s.device_id]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Predicted:"})," ",s.predicted_date.toLocaleDateString(),s.timeline_position<=3&&e.jsxs("span",{className:"ml-1 text-red-600 font-medium",children:["(",s.timeline_position===0?"TODAY":`${s.timeline_position} days`,")"]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Confidence:"})," ",(s.confidence_score*100).toFixed(0),"%",s.health_score&&e.jsxs("span",{className:"ml-2",children:["| ",e.jsx("strong",{children:"Health:"})," ",s.health_score.toFixed(1),"%"]})]})]})]}),s.status==="active"&&e.jsx("button",{onClick:a=>{a.stopPropagation(),S(s)},className:"ml-4 px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors",children:"Acknowledge"})]})},s.id))})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Maintenance Event Details"}),e.jsx("button",{onClick:()=>g(null),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Device:"})," ",i.device_id]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Alert Type:"})," ",i.alert_type.replace("_"," ")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Severity:"}),e.jsx("span",{className:"ml-2 px-2 py-1 rounded text-xs font-medium",style:{backgroundColor:l[i.severity]+"20",color:l[i.severity]},children:i.severity.toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Predicted Date:"})," ",i.predicted_date.toLocaleString()]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Confidence:"})," ",(i.confidence_score*100).toFixed(0),"%"]}),i.health_score&&e.jsxs("div",{children:[e.jsx("strong",{children:"Current Health Score:"})," ",i.health_score.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Description:"}),e.jsx("p",{className:"text-gray-700 mt-1",children:i.description})]}),i.recommended_actions.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"Recommended Actions:"}),e.jsx("ul",{className:"list-disc list-inside mt-1 space-y-1",children:i.recommended_actions.map((s,a)=>e.jsx("li",{className:"text-gray-700",children:s},a))})]}),i.affected_systems.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"Affected Systems:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:i.affected_systems.map((s,a)=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded text-sm",children:s},a))})]}),e.jsxs("div",{className:"pt-4 border-t flex justify-end space-x-3",children:[i.status==="active"&&e.jsx("button",{onClick:()=>S(i),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Acknowledge Alert"}),e.jsx("button",{onClick:()=>g(null),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition-colors",children:"Close"})]})]})]})})]})};export{z as default};
