import{c as G,s as z,a as te,b as ae,d as _e,e as V,g as we,i as re,f as q,h as Ae,r as se,u as ie,j as h,R as Se,S as Ce,k as De,l as Ie,m as Pe,n as ne,o as Ee,p as Me,q as Le,t as He,v as Re,G as Oe,w as le,x as oe,y as ce,L as H,z as Fe,A as U,B as X,C as Y,D as M,E as Te,J as Be,F as E,H as We,I as $e,K as de,M as F,N as Ke,O as R,P as Ge,Q as ze,T as Ve,U as r,V as Q,W as T,X as qe,Y as Ue,Z as J,_ as B,$ as he,a0 as ue,a1 as me,a2 as Xe,a3 as Ye}from"./index-DkNXKMsf.js";import{B as Qe,a as Je}from"./BarChart-ai-nNWAX.js";var pe=(e,a,t,s)=>te(e,"xAxis",a,s),xe=(e,a,t,s)=>ae(e,"xAxis",a,s),fe=(e,a,t,s)=>te(e,"yAxis",t,s),ge=(e,a,t,s)=>ae(e,"yAxis",t,s),Ze=G([z,pe,fe,xe,ge],(e,a,t,s,l)=>re(e,"xAxis")?q(a,s,!1):q(t,l,!1)),et=(e,a,t,s,l)=>l,ve=G([Ae,et],(e,a)=>e.filter(t=>t.type==="area").find(t=>t.id===a)),tt=(e,a,t,s,l)=>{var n,o=ve(e,a,t,s,l);if(o!=null){var i=z(e),c=re(i,"xAxis"),u;if(c?u=V(e,"yAxis",t,s):u=V(e,"xAxis",a,s),u!=null){var{stackId:p}=o,x=we(o);if(!(p==null||x==null)){var g=(n=u[p])===null||n===void 0?void 0:n.stackedData;return g?.find(v=>v.key===x)}}}},at=G([z,pe,fe,xe,ge,tt,_e,Ze,ve],(e,a,t,s,l,n,o,i,c)=>{var{chartData:u,dataStartIndex:p,dataEndIndex:x}=o;if(!(c==null||e!=="horizontal"&&e!=="vertical"||a==null||t==null||s==null||l==null||s.length===0||l.length===0||i==null)){var{data:g}=c,v;if(g&&g.length>0?v=g:v=u?.slice(p,x+1),v!=null){var f=void 0;return kt({layout:e,xAxis:a,yAxis:t,xAxisTicks:s,yAxisTicks:l,dataStartIndex:p,areaSettings:c,stackedData:n,displayedData:v,chartBaseValue:f,bandSize:i})}}}),rt=["id"],st=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function ye(e,a){if(e==null)return{};var t,s,l=it(e,a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(s=0;s<n.length;s++)t=n[s],a.indexOf(t)===-1&&{}.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}function it(e,a){if(e==null)return{};var t={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(a.indexOf(s)!==-1)continue;t[s]=e[s]}return t}function Z(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);a&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),t.push.apply(t,s)}return t}function P(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?Z(Object(t),!0).forEach(function(s){nt(e,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Z(Object(t)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))})}return e}function nt(e,a,t){return(a=lt(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function lt(e){var a=ot(e,"string");return typeof a=="symbol"?a:a+""}function ot(e,a){if(typeof e!="object"||!e)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var s=t.call(e,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(e)}function S(){return S=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var s in t)({}).hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},S.apply(null,arguments)}function O(e,a){return e&&e!=="none"?e:a}var ct=e=>{var{dataKey:a,name:t,stroke:s,fill:l,legendType:n,hide:o}=e;return[{inactive:o,dataKey:a,type:n,color:O(s,l),value:ne(t,a),payload:e}]};function dt(e){var{dataKey:a,data:t,stroke:s,strokeWidth:l,fill:n,name:o,hide:i,unit:c}=e;return{dataDefinedOnItem:t,positions:void 0,settings:{stroke:s,strokeWidth:l,fill:n,dataKey:a,nameKey:void 0,name:ne(o,a),hide:i,type:e.tooltipType,color:O(s,n),unit:c}}}var ht=(e,a)=>{var t;if(h.isValidElement(e))t=h.cloneElement(e,a);else if(typeof e=="function")t=e(a);else{var s=le("recharts-area-dot",typeof e!="boolean"?e.className:"");t=h.createElement(Ge,S({},a,{className:s}))}return t};function ut(e,a){return e==null?!1:a?!0:e.length===1}function mt(e){var{clipPathId:a,points:t,props:s}=e,{needClip:l,dot:n,dataKey:o}=s;if(!ut(t,n))return null;var i=ce(n),c=de(s),u=oe(n,!0),p=t.map((g,v)=>{var f=P(P(P({key:"dot-".concat(v),r:3},c),u),{},{index:v,cx:g.x,cy:g.y,dataKey:o,value:g.value,payload:g.payload,points:t});return ht(n,f)}),x={clipPath:l?"url(#clipPath-".concat(i?"":"dots-").concat(a,")"):void 0};return h.createElement(H,S({className:"recharts-area-dots"},x),p)}function W(e){var{points:a,baseLine:t,needClip:s,clipPathId:l,props:n,showLabels:o}=e,{layout:i,type:c,stroke:u,connectNulls:p,isRange:x}=n,{id:g}=n,v=ye(n,rt),f=de(v);return h.createElement(h.Fragment,null,a?.length>1&&h.createElement(H,{clipPath:s?"url(#clipPath-".concat(l,")"):void 0},h.createElement(F,S({},f,{id:g,points:a,connectNulls:p,type:c,baseLine:t,layout:i,stroke:"none",className:"recharts-area-area"})),u!=="none"&&h.createElement(F,S({},f,{className:"recharts-area-curve",layout:i,type:c,connectNulls:p,fill:"none",points:a})),u!=="none"&&x&&h.createElement(F,S({},f,{className:"recharts-area-curve",layout:i,type:c,connectNulls:p,fill:"none",points:t}))),h.createElement(mt,{points:a,props:v,clipPathId:l}),o&&Ke.renderCallByParent(v,a))}function pt(e){var{alpha:a,baseLine:t,points:s,strokeWidth:l}=e,n=s[0].y,o=s[s.length-1].y;if(!R(n)||!R(o))return null;var i=a*Math.abs(n-o),c=Math.max(...s.map(u=>u.x||0));return M(t)?c=Math.max(t,c):t&&Array.isArray(t)&&t.length&&(c=Math.max(...t.map(u=>u.x||0),c)),M(c)?h.createElement("rect",{x:0,y:n<o?n:n-i,width:c+(l?parseInt("".concat(l),10):1),height:Math.floor(i)}):null}function xt(e){var{alpha:a,baseLine:t,points:s,strokeWidth:l}=e,n=s[0].x,o=s[s.length-1].x;if(!R(n)||!R(o))return null;var i=a*Math.abs(n-o),c=Math.max(...s.map(u=>u.y||0));return M(t)?c=Math.max(t,c):t&&Array.isArray(t)&&t.length&&(c=Math.max(...t.map(u=>u.y||0),c)),M(c)?h.createElement("rect",{x:n<o?n:n-i,y:0,width:i,height:Math.floor(c+(l?parseInt("".concat(l),10):1))}):null}function ft(e){var{alpha:a,layout:t,points:s,baseLine:l,strokeWidth:n}=e;return t==="vertical"?h.createElement(pt,{alpha:a,points:s,baseLine:l,strokeWidth:n}):h.createElement(xt,{alpha:a,points:s,baseLine:l,strokeWidth:n})}function gt(e){var{needClip:a,clipPathId:t,props:s,previousPointsRef:l,previousBaselineRef:n}=e,{points:o,baseLine:i,isAnimationActive:c,animationBegin:u,animationDuration:p,animationEasing:x,onAnimationStart:g,onAnimationEnd:v}=s,f=Te(s,"recharts-area-"),[k,j]=h.useState(!0),N=h.useCallback(()=>{typeof v=="function"&&v(),j(!1)},[v]),_=h.useCallback(()=>{typeof g=="function"&&g(),j(!0)},[g]),m=l.current,d=n.current;return h.createElement(Be,{begin:u,duration:p,isActive:c,easing:x,onAnimationEnd:N,onAnimationStart:_,key:f},y=>{if(m){var b=m.length/o.length,A=y===1?o:o.map((w,L)=>{var D=Math.floor(L*b);if(m[D]){var I=m[D];return P(P({},w),{},{x:E(I.x,w.x,y),y:E(I.y,w.y,y)})}return w}),C;return M(i)?C=E(d,i,y):We(i)||$e(i)?C=E(d,0,y):C=i.map((w,L)=>{var D=Math.floor(L*b);if(Array.isArray(d)&&d[D]){var I=d[D];return P(P({},w),{},{x:E(I.x,w.x,y),y:E(I.y,w.y,y)})}return w}),y>0&&(l.current=A,n.current=C),h.createElement(W,{points:A,baseLine:C,needClip:a,clipPathId:t,props:s,showLabels:!k})}return y>0&&(l.current=o,n.current=i),h.createElement(H,null,h.createElement("defs",null,h.createElement("clipPath",{id:"animationClipPath-".concat(t)},h.createElement(ft,{alpha:y,points:o,baseLine:i,layout:s.layout,strokeWidth:s.strokeWidth}))),h.createElement(H,{clipPath:"url(#animationClipPath-".concat(t,")")},h.createElement(W,{points:o,baseLine:i,needClip:a,clipPathId:t,props:s,showLabels:!0})))})}function vt(e){var{needClip:a,clipPathId:t,props:s}=e,{points:l,baseLine:n,isAnimationActive:o}=s,i=h.useRef(null),c=h.useRef(),u=i.current,p=c.current;return o&&l&&l.length&&(u!==l||p!==n)?h.createElement(gt,{needClip:a,clipPathId:t,props:s,previousPointsRef:i,previousBaselineRef:c}):h.createElement(W,{points:l,baseLine:n,needClip:a,clipPathId:t,props:s,showLabels:!0})}class yt extends h.PureComponent{render(){var a,{hide:t,dot:s,points:l,className:n,top:o,left:i,needClip:c,xAxisId:u,yAxisId:p,width:x,height:g,id:v,baseLine:f}=this.props;if(t)return null;var k=le("recharts-area",n),j=v,{r:N=3,strokeWidth:_=2}=(a=oe(s,!1))!==null&&a!==void 0?a:{r:3,strokeWidth:2},m=ce(s),d=N*2+_;return h.createElement(h.Fragment,null,h.createElement(H,{className:k},c&&h.createElement("defs",null,h.createElement(Fe,{clipPathId:j,xAxisId:u,yAxisId:p}),!m&&h.createElement("clipPath",{id:"clipPath-dots-".concat(j)},h.createElement("rect",{x:i-d/2,y:o-d/2,width:x+d,height:g+d}))),h.createElement(vt,{needClip:c,clipPathId:j,props:this.props})),h.createElement(U,{points:l,mainColor:O(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot}),this.props.isRange&&Array.isArray(f)&&h.createElement(U,{points:f,mainColor:O(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot}))}}var be={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:!Oe.isSsr,legendType:"line",stroke:"#3182bd",xAxisId:0,yAxisId:0};function bt(e){var a,t=se(e,be),{activeDot:s,animationBegin:l,animationDuration:n,animationEasing:o,connectNulls:i,dot:c,fill:u,fillOpacity:p,hide:x,isAnimationActive:g,legendType:v,stroke:f,xAxisId:k,yAxisId:j}=t,N=ye(t,st),_=Ee(),m=Me(),{needClip:d}=Le(k,j),y=ie(),{points:b,isRange:A,baseLine:C}=(a=He(Ne=>at(Ne,k,j,y,e.id)))!==null&&a!==void 0?a:{},w=Re();if(_!=="horizontal"&&_!=="vertical"||w==null||m!=="AreaChart"&&m!=="ComposedChart")return null;var{height:L,width:D,x:I,y:ke}=w;return!b||!b.length?null:h.createElement(yt,S({},N,{activeDot:s,animationBegin:l,animationDuration:n,animationEasing:o,baseLine:C,connectNulls:i,dot:c,fill:u,fillOpacity:p,height:L,hide:x,layout:_,isAnimationActive:g,isRange:A,legendType:v,needClip:d,points:b,stroke:f,width:D,left:I,top:ke,xAxisId:k,yAxisId:j}))}var jt=(e,a,t,s,l)=>{var n=t??a;if(M(n))return n;var o=e==="horizontal"?l:s,i=o.scale.domain();if(o.type==="number"){var c=Math.max(i[0],i[1]),u=Math.min(i[0],i[1]);return n==="dataMin"?u:n==="dataMax"||c<0?c:Math.max(Math.min(i[0],i[1]),0)}return n==="dataMin"?i[0]:n==="dataMax"?i[1]:i[0]};function kt(e){var{areaSettings:{connectNulls:a,baseValue:t,dataKey:s},stackedData:l,layout:n,chartBaseValue:o,xAxis:i,yAxis:c,displayedData:u,dataStartIndex:p,xAxisTicks:x,yAxisTicks:g,bandSize:v}=e,f=l&&l.length,k=jt(n,o,t,i,c),j=n==="horizontal",N=!1,_=u.map((d,y)=>{var b;f?b=l[p+y]:(b=X(d,s),Array.isArray(b)?N=!0:b=[k,b]);var A=b[1]==null||f&&!a&&X(d,s)==null;return j?{x:Y({axis:i,ticks:x,bandSize:v,entry:d,index:y}),y:A?null:c.scale(b[1]),value:b,payload:d}:{x:A?null:i.scale(b[1]),y:Y({axis:c,ticks:g,bandSize:v,entry:d,index:y}),value:b,payload:d}}),m;return f||N?m=_.map(d=>{var y=Array.isArray(d.value)?d.value[0]:null;return j?{x:d.x,y:y!=null&&d.y!=null?c.scale(y):null,payload:d.payload}:{x:y!=null?i.scale(y):null,y:d.y,payload:d.payload}}):m=j?c.scale(k):i.scale(k),{points:_,baseLine:m,isRange:N}}function $(e){var a=se(e,be),t=ie();return h.createElement(Se,{id:a.id,type:"area"},s=>h.createElement(h.Fragment,null,h.createElement(Ce,{legendPayload:ct(a)}),h.createElement(De,{fn:dt,args:a}),h.createElement(Ie,{type:"area",id:s,data:a.data,dataKey:a.dataKey,xAxisId:a.xAxisId,yAxisId:a.yAxisId,zAxisId:0,stackId:Pe(a.stackId),hide:a.hide,barSize:void 0,baseValue:a.baseValue,isPanorama:t,connectNulls:a.connectNulls}),h.createElement(bt,S({},a,{id:s}))))}$.displayName="Area";var Nt=["axis"],_t=h.forwardRef((e,a)=>h.createElement(ze,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:Nt,tooltipPayloadSearcher:Ve,categoricalChartProps:e,ref:a}));const ee=e=>`${Math.round(e)}%`,K=e=>{switch(e){case"low":return"text-green-600 bg-green-50 border-green-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"high":return"text-orange-600 bg-orange-50 border-orange-200";case"critical":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},wt=e=>e.length===0?null:[...e].sort((t,s)=>t.health_score-s.health_score)[0],At=e=>{if(e.length===0)return{averageHealth:0,totalDevices:0,riskBreakdown:{low:0,medium:0,high:0,critical:0},healthyDevices:0,atRiskDevices:0};const a=e.reduce((n,o)=>n+o.health_score,0)/e.length,t=e.reduce((n,o)=>(n[o.risk_level]=(n[o.risk_level]||0)+1,n),{low:0,medium:0,high:0,critical:0}),s=t.low,l=t.medium+t.high+t.critical;return{averageHealth:a,totalDevices:e.length,riskBreakdown:t,healthyDevices:s,atRiskDevices:l}},St=e=>{if(e.length===0)return{healthScore:50,riskLevel:"medium",explanatoryFactors:[]};const a=e.map(m=>m.current_amp).filter(m=>m>0),t=e.map(m=>m.battery_level).filter(m=>m>0),s=e.filter(m=>m.gps_lat&&m.gps_lon),l=a.reduce((m,d)=>m+d,0)/a.length||0,n=je(a),o=t.reduce((m,d)=>m+d,0)/t.length||0,i=Math.max(...t,0)-Math.min(...t,100),c=s.length/e.length,u=Ct(s),p=e.filter(m=>m.current_amp>0&&m.battery_level>0&&m.gps_lat&&m.gps_lon).length/e.length;let x=100;const g=Math.max(0,100-n*50-Math.max(0,(l-5)*10));x-=(100-g)*.3;const v=Math.max(0,Math.min(100,o-i*2));x-=(100-v)*.25;const f=c*100;x-=(100-f)*.2;const k=p*100;x-=(100-k)*.15;const j=Math.max(0,100-u*100);x-=(100-j)*.1,x=Math.max(0,Math.min(100,x));const N=x>=80?"low":x>=60?"medium":x>=40?"high":"critical",_=[{feature:"Current Draw Stability",value:n,importance:.3,impact:n>.5?"High current variability indicates potential electrical issues":"Stable current draw suggests healthy electrical system"},{feature:"Battery Performance",value:o,importance:.25,impact:o<50?"Low average battery level may indicate charging issues":"Good battery performance supports reliable operation"},{feature:"GPS Signal Quality",value:c*100,importance:.2,impact:c<.8?"Intermittent GPS signal affects positioning accuracy":"Reliable GPS signal ensures accurate positioning"}].sort((m,d)=>d.importance-m.importance);return{healthScore:x,riskLevel:N,explanatoryFactors:_}},je=e=>{if(e.length===0)return 0;const a=e.reduce((l,n)=>l+n,0)/e.length;if(a===0)return 0;const t=e.reduce((l,n)=>l+Math.pow(n-a,2),0)/e.length;return Math.sqrt(t)/a},Ct=e=>{if(e.length<2)return 0;const a=[];for(let t=1;t<e.length;t++){const s=e[t-1],l=e[t],n=Math.sqrt(Math.pow(l.gps_lat-s.gps_lat,2)+Math.pow(l.gps_lon-s.gps_lon,2));a.push(n)}return je(a)},Dt=async()=>{try{const t=(await(await fetch("/data/raw_drilling_sessions.csv")).text()).split(`
`).slice(1),s=[];for(const o of t)if(o.trim()){const[i,c,u,p,x,g,v,f]=o.split(",");s.push({timestamp:i?.trim(),device_id:c?.trim(),seq:parseInt(u?.trim()||"0"),current_amp:parseFloat(p?.trim()||"0"),gps_lat:parseFloat(x?.trim()||"0"),gps_lon:parseFloat(g?.trim()||"0"),battery_level:parseInt(v?.trim()||"0"),ble_id:f?.trim()})}const l=s.reduce((o,i)=>(o[i.device_id]||(o[i.device_id]=[]),o[i.device_id].push(i),o),{}),n=[];return Object.entries(l).forEach(([o,i])=>{const{healthScore:c,riskLevel:u,explanatoryFactors:p}=St(i),x=5+Math.random()*10;n.push({device_id:o,health_score:c,confidence_interval:[Math.max(0,c-x),Math.min(100,c+x)],risk_level:u,explanatory_factors:p,last_calculated:new Date().toISOString()})}),n.sort((o,i)=>o.device_id.localeCompare(i.device_id))}catch(e){return console.error("Failed to generate health scores from telemetry:",e),[]}},It=e=>{const a=[];return e.forEach((t,s)=>{if(t.risk_level!=="low"){const l=["performance_degradation","equipment_failure_risk","battery_maintenance"],n=l[s%l.length],o=t.risk_level==="critical"?"critical":t.risk_level==="high"?"high":t.risk_level==="medium"?"medium":"low",i=t.health_score<40?new Date(Date.now()+(Math.random()*72+24)*60*60*1e3):void 0;a.push({id:`fallback-alert-${t.device_id}-${s}`,device_id:t.device_id,alert_type:n,severity:o,status:"active",title:`${t.risk_level.toUpperCase()} Risk: ${t.device_id}`,description:`Health score of ${Math.round(t.health_score)}% indicates ${t.risk_level} risk. ${t.explanatory_factors[0]?.impact||"Monitor equipment performance closely."}`,predicted_failure_time:i?.toISOString(),confidence_score:Math.random()*.3+.6,recommended_actions:Pt(t.risk_level,n),affected_systems:Et(n),created_at:new Date(Date.now()-Math.random()*24*60*60*1e3).toISOString(),metadata:{source:"telemetry_analysis",health_score:t.health_score,risk_level:t.risk_level}})}}),a},Pt=(e,a)=>{const t=[];return e==="critical"&&(t.push("Schedule immediate maintenance inspection"),t.push("Reduce operational load until inspection")),a==="battery_maintenance"?(t.push("Check battery charging system"),t.push("Inspect battery connections")):a==="performance_degradation"?(t.push("Review current consumption patterns"),t.push("Check electrical connections")):a==="equipment_failure_risk"&&(t.push("Schedule comprehensive equipment check"),t.push("Monitor operational parameters closely")),t.push("Update maintenance logs"),t},Et=e=>{switch(e){case"battery_maintenance":return["Power System","Charging Circuit"];case"performance_degradation":return["Drilling Motor","Electrical System"];case"equipment_failure_risk":return["Primary Drive","Control System","Sensors"];default:return["General Equipment"]}},Mt=({device:e,onClick:a,isSelected:t})=>{const s=e.health_score,l=2*Math.PI*45,n=l,o=l-s/100*l,i=p=>p>=80?"#10b981":p>=60?"#f59e0b":p>=40?"#f97316":"#ef4444",u=K(e.risk_level).split(" ").find(p=>p.includes("bg-"))?.replace("bg-","")||"gray-50";return r.jsxs("div",{className:`relative p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 ${t?"border-blue-500 shadow-lg bg-blue-50":`border-gray-200 hover:border-gray-300 bg-${u}`}`,onClick:a,children:[r.jsx("div",{className:`absolute top-2 right-2 px-2 py-1 rounded-full text-xs font-medium ${K(e.risk_level)}`,children:e.risk_level.toUpperCase()}),r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsxs("div",{className:"relative w-24 h-24",children:[r.jsxs("svg",{className:"w-24 h-24 transform -rotate-90",viewBox:"0 0 100 100",children:[r.jsx("circle",{cx:"50",cy:"50",r:"45",stroke:"#e5e7eb",strokeWidth:"8",fill:"none"}),r.jsx("circle",{cx:"50",cy:"50",r:"45",stroke:i(s),strokeWidth:"8",fill:"none",strokeDasharray:n,strokeDashoffset:o,strokeLinecap:"round",className:"transition-all duration-500"})]}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsxs("span",{className:"text-lg font-bold text-gray-900",children:[Math.round(s),"%"]})})]}),r.jsxs("div",{className:"mt-3 text-center",children:[r.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:e.device_id}),r.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Updated: ",new Date(e.last_calculated).toLocaleDateString()]})]}),r.jsx("div",{className:"mt-2 text-xs text-gray-600 text-center",children:r.jsxs("span",{children:["CI: ",Math.round(e.confidence_interval[0]),"% - ",Math.round(e.confidence_interval[1]),"%"]})})]})]})},Lt=({selectedDevice:e})=>{const a=h.useMemo(()=>{if(!e)return[];const t=e.health_score,s=[],l=new Date;for(let n=29;n>=0;n--){const o=new Date(l);o.setDate(o.getDate()-n);const i=(Math.random()-.5)*10,c=(29-n)*.5,u=Math.max(0,Math.min(100,t+i-c));s.push({date:o.toISOString().split("T")[0],displayDate:o.toLocaleDateString(),health_score:Math.round(u),confidence_low:Math.round(Math.max(0,u-5)),confidence_high:Math.round(Math.min(100,u+5))})}return s},[e]);return e?r.jsx("div",{className:"h-80",children:r.jsx(T,{width:"100%",height:"100%",children:r.jsxs(_t,{data:a,children:[r.jsx(he,{strokeDasharray:"3 3"}),r.jsx(ue,{dataKey:"date",tickFormatter:t=>new Date(t).toLocaleDateString(),tick:{fontSize:12}}),r.jsx(me,{label:{value:"Health Score (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),r.jsx(B,{formatter:(t,s)=>[`${t}%`,s==="health_score"?"Health Score":s==="confidence_low"?"Lower CI":"Upper CI"],labelFormatter:t=>new Date(t).toLocaleDateString()}),r.jsx(Xe,{}),r.jsx($,{type:"monotone",dataKey:"confidence_high",stackId:"1",stroke:"none",fill:"#3b82f6",fillOpacity:.1}),r.jsx($,{type:"monotone",dataKey:"confidence_low",stackId:"1",stroke:"none",fill:"#ffffff",fillOpacity:1}),r.jsx(Ye,{type:"monotone",dataKey:"health_score",stroke:"#3b82f6",strokeWidth:3,dot:{r:4}})]})})}):r.jsx("div",{className:"h-80 flex items-center justify-center bg-gray-100 rounded",children:r.jsx("p",{className:"text-gray-500",children:"Select a device to view health trends"})})},Ht=({healthScores:e,alerts:a})=>{const t=At(e),s=wt(e),l=[{name:"Low Risk",count:t.riskBreakdown.low,color:"#10b981"},{name:"Medium Risk",count:t.riskBreakdown.medium,color:"#f59e0b"},{name:"High Risk",count:t.riskBreakdown.high,color:"#f97316"},{name:"Critical Risk",count:t.riskBreakdown.critical,color:"#ef4444"}].filter(i=>i.count>0),n=a.filter(i=>i.status==="active").length,o=a.filter(i=>i.status==="active"&&i.severity==="critical").length;return r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border border-gray-200",children:[r.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Fleet Overview"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-gray-600",children:"Total Devices"}),r.jsx("span",{className:"text-xl font-semibold text-gray-900",children:t.totalDevices})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-gray-600",children:"Average Health"}),r.jsx("span",{className:"text-xl font-semibold text-blue-600",children:ee(t.averageHealth)})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-gray-600",children:"Healthy Devices"}),r.jsx("span",{className:"text-xl font-semibold text-green-600",children:t.healthyDevices})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-gray-600",children:"At Risk Devices"}),r.jsx("span",{className:`text-xl font-semibold ${t.atRiskDevices>0?"text-red-600":"text-green-600"}`,children:t.atRiskDevices})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-gray-600",children:"Active Alerts"}),r.jsx("span",{className:`text-xl font-semibold ${n>0?"text-red-600":"text-green-600"}`,children:n})]}),o>0&&r.jsxs("div",{className:"flex justify-between items-center p-2 bg-red-50 rounded",children:[r.jsx("span",{className:"text-red-800 font-medium",children:"🚨 Critical Alerts"}),r.jsx("span",{className:"text-xl font-bold text-red-600",children:o})]})]})]}),s&&r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border border-red-200",children:[r.jsx("h4",{className:"text-lg font-semibold text-red-900 mb-4",children:"⚠️ Most Critical Device"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Device ID"}),r.jsx("span",{className:"font-semibold",children:s.device_id})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Health Score"}),r.jsx("span",{className:"font-semibold text-red-600",children:ee(s.health_score)})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Risk Level"}),r.jsx("span",{className:`font-semibold px-2 py-1 rounded ${K(s.risk_level)}`,children:s.risk_level.toUpperCase()})]})]})]})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border border-gray-200",children:[r.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Risk Distribution"}),l.length>0?r.jsx("div",{className:"h-64",children:r.jsx(T,{width:"100%",height:"100%",children:r.jsxs(qe,{children:[r.jsx(Ue,{data:l,dataKey:"count",nameKey:"name",cx:"50%",cy:"50%",outerRadius:80,label:({name:i,count:c})=>`${i}: ${c}`,children:l.map((i,c)=>r.jsx(J,{fill:i.color},`cell-${c}`))}),r.jsx(B,{})]})})}):r.jsx("div",{className:"h-64 flex items-center justify-center text-gray-500",children:"No devices to display"})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border border-gray-200",children:[r.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Health Score Distribution"}),r.jsx("div",{className:"h-64",children:r.jsx(T,{width:"100%",height:"100%",children:r.jsxs(Qe,{data:[{range:"0-20%",count:e.filter(i=>i.health_score<20).length,color:"#ef4444"},{range:"20-40%",count:e.filter(i=>i.health_score>=20&&i.health_score<40).length,color:"#f97316"},{range:"40-60%",count:e.filter(i=>i.health_score>=40&&i.health_score<60).length,color:"#f59e0b"},{range:"60-80%",count:e.filter(i=>i.health_score>=60&&i.health_score<80).length,color:"#3b82f6"},{range:"80-100%",count:e.filter(i=>i.health_score>=80).length,color:"#10b981"}],children:[r.jsx(he,{strokeDasharray:"3 3"}),r.jsx(ue,{dataKey:"range",tick:{fontSize:12}}),r.jsx(me,{}),r.jsx(B,{formatter:i=>[`${i} devices`,"Count"]}),r.jsx(Je,{dataKey:"count",fill:"#3b82f6",children:e.length>0&&r.jsx(J,{fill:"#ef4444"})})]})})})]})]})},Rt=({device:e})=>r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border border-gray-200",children:[r.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Top Contributing Factors - ",e.device_id]}),r.jsx("div",{className:"space-y-4",children:e.explanatory_factors.map((a,t)=>r.jsxs("div",{className:"border-l-4 border-blue-500 pl-4",children:[r.jsxs("div",{className:"flex justify-between items-center mb-2",children:[r.jsx("h5",{className:"font-medium text-gray-900",children:a.feature}),r.jsxs("span",{className:"text-sm font-semibold text-blue-600",children:[Math.round(a.importance*100),"% importance"]})]}),r.jsxs("div",{className:"flex justify-between items-center mb-2",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Current Value"}),r.jsx("span",{className:"text-sm font-medium text-gray-900",children:typeof a.value=="number"?a.value.toFixed(2):a.value})]}),r.jsx("p",{className:"text-sm text-gray-700",children:a.impact}),r.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2",children:r.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:{width:`${a.importance*100}%`}})})]},t))})]}),Tt=()=>{const[e,a]=h.useState([]),[t,s]=h.useState([]),[l,n]=h.useState(!0),[o,i]=h.useState(null),[c,u]=h.useState(null),[p,x]=h.useState(!1),[g,v]=h.useState(!1),[f,k]=h.useState({riskLevel:"",minHealthScore:"",maxHealthScore:""}),j=async()=>{try{n(!0),i(null),console.log("Loading health scores from telemetry data...");const d=await Dt();console.log("Health scores loaded:",d.length,"devices");const y=It(d);console.log("Alerts generated:",y.length,"alerts");try{const b=await Q.getHealthScores(),A=await Q.getAlerts({status:"active"});console.log("ML system available - using ML enhanced data"),a(b.health_scores),s(A.alerts),x(!0),v(!1),b.health_scores.length>0&&!c&&u(b.health_scores[0])}catch{console.log("ML system unavailable, using telemetry analysis as primary data source"),a(d),s(y),x(!1),v(!0),d.length>0&&!c&&u(d[0])}}catch(d){console.error("Failed to load health data:",d),i(d instanceof Error?d.message:"Failed to load health scores"),x(!1),v(!1)}finally{n(!1)}};h.useEffect(()=>{j()},[]);const N=h.useMemo(()=>e.filter(d=>!(f.riskLevel&&d.risk_level!==f.riskLevel||f.minHealthScore&&d.health_score<parseFloat(f.minHealthScore)||f.maxHealthScore&&d.health_score>parseFloat(f.maxHealthScore))),[e,f]),_=d=>{u(d)},m=(d,y)=>{k(b=>({...b,[d]:y}))};return l?r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 border border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-center h-64",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),r.jsx("span",{className:"ml-3 text-gray-600",children:"Loading equipment health data..."})]})}):o?r.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 border border-red-200",children:r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsxs("div",{className:"text-center",children:[r.jsx("svg",{className:"w-12 h-12 text-red-500 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),r.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-2",children:"Failed to Load Health Data"}),r.jsx("p",{className:"text-red-700 mb-4",children:o}),r.jsx("button",{onClick:j,className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition-colors",children:"Retry"})]})})}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Equipment Health Scores"}),r.jsx("p",{className:"text-gray-600",children:"AI-powered health monitoring and predictive maintenance insights"}),r.jsx("div",{className:"flex items-center mt-2",children:r.jsxs("div",{className:`flex items-center space-x-2 px-3 py-1 rounded-full text-xs font-medium ${g?"bg-blue-100 text-blue-800":p?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[r.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${g?"bg-blue-500":p?"bg-green-500":"bg-red-500"}`}),r.jsx("span",{children:g?"Real Telemetry Analysis":p?"ML Enhanced Analysis":"System Offline"})]})})]}),r.jsx("button",{onClick:j,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"Refresh Data"})]}),r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 border border-gray-200",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Filters"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Risk Level"}),r.jsxs("select",{value:f.riskLevel,onChange:d=>m("riskLevel",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"All Levels"}),r.jsx("option",{value:"low",children:"Low Risk"}),r.jsx("option",{value:"medium",children:"Medium Risk"}),r.jsx("option",{value:"high",children:"High Risk"}),r.jsx("option",{value:"critical",children:"Critical Risk"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Min Health Score"}),r.jsx("input",{type:"number",min:"0",max:"100",value:f.minHealthScore,onChange:d=>m("minHealthScore",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Max Health Score"}),r.jsx("input",{type:"number",min:"0",max:"100",value:f.maxHealthScore,onChange:d=>m("maxHealthScore",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"100"})]}),r.jsx("div",{className:"flex items-end",children:r.jsx("button",{onClick:()=>k({riskLevel:"",minHealthScore:"",maxHealthScore:""}),className:"w-full px-3 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors text-sm",children:"Clear Filters"})})]})]}),r.jsx(Ht,{healthScores:N,alerts:t}),r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border border-gray-200",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Device Health Scores (",N.length," devices)"]}),N.length>0?r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:N.map(d=>r.jsx(Mt,{device:d,onClick:()=>_(d),isSelected:c?.device_id===d.device_id},d.device_id))}):r.jsx("div",{className:"text-center py-8 text-gray-500",children:"No devices match the current filters"})]}),c&&r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border border-gray-200",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Health Trend - ",c.device_id]}),r.jsx(Lt,{selectedDevice:c})]}),r.jsx(Rt,{device:c})]})]})};export{Tt as default};
