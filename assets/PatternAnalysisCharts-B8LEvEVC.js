import{j as o,a4 as q,U as e,W as w,a5 as Z,$ as C,a0 as S,a1 as b,_ as D,a2 as R,a3 as T,Z as J}from"./index-DkNXKMsf.js";import{B as $,a as A}from"./BarChart-ai-nNWAX.js";const te=({className:v=""})=>{const[z,O]=o.useState([]),[m,B]=o.useState(null),[M,I]=o.useState(!0),[P,k]=o.useState(null),[x,L]=o.useState(new Set),[E,K]=o.useState("7d"),[f,H]=o.useState("current");o.useEffect(()=>{_()},[E]);const _=async()=>{I(!0),k(null);try{const[t,a]=await Promise.all([q.getInsights("2025-07-01","2025-07-31"),q.getBatteryTrends("2025-07-01","2025-07-31")]);O(a.trends);const s=U(t,a.trends);B(s);const h=new Set(a.trends.map(y=>y.device_id));L(h)}catch(t){k(t instanceof Error?t.message:"Failed to load pattern data"),console.error("Failed to load pattern data:",t)}finally{I(!1)}},U=(t,a)=>{const s=Array.from(new Set(a.map(r=>r.device_id))),h=a.map((r,d)=>{const p=d>0?a[d-1].battery_level-r.battery_level:0,c=Math.max(.5,Math.min(8,2+p*.5));let i="STANDBY";c<=.5?i="OFF":c<=2?i="STANDBY":c<=4.5?i="SPIN":i="DRILL";const n=i==="DRILL"?Math.max(.6,1-(c-4.5)/4):i==="SPIN"?Math.max(.7,1-(c-2)/2.5):.9;return{timestamp:r.timestamp,device_id:r.device_id,current_amp:c,operating_state:i,efficiency_score:n,recommended_current:i==="DRILL"?5:i==="SPIN"?3.5:1}}),y=s.map(r=>{const p=a.filter(g=>g.device_id===r).map(g=>g.battery_level),c=p.reduce((g,N)=>g+N,0)/p.length,i=p.reduce((g,N)=>g+Math.pow(N-c,2),0)/p.length;let n;c>70&&i<200?n="efficient":c>50&&i<400?n="moderate":n="inefficient";const j=[];return c<60&&j.push("Increase charging frequency"),i>300&&j.push("Implement consistent usage patterns"),Math.min(...p)<20&&j.push("Set minimum battery threshold alerts"),{device_id:r,current_usage_pattern:n,charging_frequency:n==="efficient"?1.2:n==="moderate"?1.8:2.4,battery_degradation_rate:n==="efficient"?2.1:n==="moderate"?3.2:4.8,recommended_charge_threshold:n==="efficient"?25:30,potential_savings_hours:n==="efficient"?2.4:n==="moderate"?4.8:8.2,optimization_actions:j}}),G=[{pattern_name:"High Current During Spin State",correlation_strength:-.73,health_impact:"negative",frequency:23,recommendation:"Reduce current draw in spin state to improve motor longevity"},{pattern_name:"Consistent Charging Cycles",correlation_strength:.82,health_impact:"positive",frequency:45,recommendation:"Maintain regular charging schedule for optimal battery health"},{pattern_name:"Extended Drilling Sessions",correlation_strength:-.45,health_impact:"negative",frequency:12,recommendation:"Implement cooling periods between long drilling sessions"},{pattern_name:"Gradual Current Ramp-up",correlation_strength:.67,health_impact:"positive",frequency:67,recommendation:"Continue gradual current increases for equipment protection"}],V=[{category:"efficiency",title:"Current Consumption Optimization",description:"Several devices showing 15-20% higher current draw than optimal for drilling operations.",impact_level:"medium",potential_benefit:"Reduce energy consumption by 12-18% and extend equipment life",action_items:["Calibrate drilling speed controls on devices DRL-002, DRL-003","Review drilling technique training for operators","Implement current draw monitoring alerts"],devices_affected:s.slice(0,2)},{category:"battery",title:"Charging Pattern Inefficiencies",description:"Inconsistent charging patterns detected leading to accelerated battery degradation.",impact_level:"high",potential_benefit:"Extend battery life by 30-40% and reduce replacement costs",action_items:["Establish standardized charging protocols","Install smart charging stations with optimization","Set battery level monitoring thresholds at 25%"],devices_affected:s.filter(r=>y.find(d=>d.device_id===r)?.current_usage_pattern!=="efficient")},{category:"operational",title:"Equipment Health Correlation",description:"Strong correlation between specific usage patterns and equipment health degradation.",impact_level:"high",potential_benefit:"Prevent 60-80% of preventable equipment failures",action_items:["Implement predictive maintenance schedules","Train operators on health-preserving usage patterns","Install vibration and temperature monitoring"],devices_affected:s}],F=h.reduce((r,d)=>r+d.efficiency_score,0)/h.length,X=s.filter(r=>y.find(d=>d.device_id===r)?.current_usage_pattern==="inefficient");return{current_patterns:h.slice(0,100),battery_insights:y,correlations:G,actionable_insights:V,summary_metrics:{overall_efficiency_score:Math.round(F*100),improvement_potential_percent:Math.round((1-F)*100),priority_devices:X,next_maintenance_days:14}}},l=o.useMemo(()=>!m||x.size===0?m:{...m,current_patterns:m.current_patterns.filter(t=>x.has(t.device_id)),battery_insights:m.battery_insights.filter(t=>x.has(t.device_id)),actionable_insights:m.actionable_insights.map(t=>({...t,devices_affected:t.devices_affected.filter(a=>x.has(a))})).filter(t=>t.devices_affected.length>0)},[m,x]),Y=t=>{const a=new Set(x);a.has(t)?a.delete(t):a.add(t),L(a)},u={primary:"#3b82f6",secondary:"#10b981",accent:"#f59e0b",danger:"#ef4444"};if(M)return e.jsxs("div",{className:`bg-white rounded-lg shadow-md p-6 border border-gray-200 ${v}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"📊 Operational Pattern Analysis"}),e.jsx("div",{className:"h-96 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Analyzing telemetry patterns..."})]})})]});if(P)return e.jsxs("div",{className:`bg-white rounded-lg shadow-md p-6 border border-gray-200 ${v}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"📊 Operational Pattern Analysis"}),e.jsx("div",{className:"h-96 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-red-600",children:[e.jsx("p",{className:"text-lg font-medium mb-2",children:"⚠️ Error Loading Data"}),e.jsx("p",{className:"text-sm",children:P}),e.jsx("button",{onClick:_,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Retry"})]})})]});if(!l)return e.jsxs("div",{className:`bg-white rounded-lg shadow-md p-6 border border-gray-200 ${v}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"📊 Operational Pattern Analysis"}),e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No pattern data available"})]});const W=Array.from(new Set(z.map(t=>t.device_id)));return e.jsxs("div",{className:`bg-white rounded-lg shadow-md p-6 border border-gray-200 ${v}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"📊 Operational Pattern Analysis"}),e.jsx("button",{onClick:_,className:"text-sm px-3 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:"🔄 Refresh Analysis"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400",children:[e.jsx("div",{className:"text-sm font-medium text-blue-800",children:"Overall Efficiency"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[l.summary_metrics.overall_efficiency_score,"%"]})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border-l-4 border-green-400",children:[e.jsx("div",{className:"text-sm font-medium text-green-800",children:"Improvement Potential"}),e.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[l.summary_metrics.improvement_potential_percent,"%"]})]}),e.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg border-l-4 border-yellow-400",children:[e.jsx("div",{className:"text-sm font-medium text-yellow-800",children:"Priority Devices"}),e.jsx("div",{className:"text-2xl font-bold text-yellow-900",children:l.summary_metrics.priority_devices.length})]}),e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg border-l-4 border-purple-400",children:[e.jsx("div",{className:"text-sm font-medium text-purple-800",children:"Next Maintenance"}),e.jsxs("div",{className:"text-2xl font-bold text-purple-900",children:[l.summary_metrics.next_maintenance_days," days"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Equipment Filter:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:W.map(t=>e.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.has(t),onChange:()=>Y(t),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm",children:t})]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Analysis Timeframe:"}),e.jsxs("select",{value:E,onChange:t=>K(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"24h",children:"Last 24 Hours"}),e.jsx("option",{value:"7d",children:"Last 7 Days"}),e.jsx("option",{value:"30d",children:"Last 30 Days"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pattern Focus:"}),e.jsxs("select",{value:f,onChange:t=>H(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"current",children:"Current Consumption"}),e.jsx("option",{value:"battery",children:"Battery Optimization"}),e.jsx("option",{value:"correlation",children:"Health Correlations"}),e.jsx("option",{value:"insights",children:"Actionable Insights"})]})]})]}),f==="current"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800",children:"Current Consumption Pattern Analysis"}),e.jsxs("div",{className:"h-64",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"Current Draw vs Efficiency Score"}),e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(Z,{data:l.current_patterns.slice(0,50),children:[e.jsx(C,{strokeDasharray:"3 3"}),e.jsx(S,{dataKey:"timestamp",tickFormatter:t=>new Date(t).toLocaleTimeString(),tick:{fontSize:12}}),e.jsx(b,{yAxisId:"current",orientation:"left",label:{value:"Current (A)",angle:-90,position:"insideLeft"}}),e.jsx(b,{yAxisId:"efficiency",orientation:"right",label:{value:"Efficiency",angle:90,position:"insideRight"}}),e.jsx(D,{labelFormatter:t=>new Date(t).toLocaleString(),formatter:(t,a)=>[a==="current_amp"?`${t.toFixed(2)}A`:`${(t*100).toFixed(1)}%`,a==="current_amp"?"Current Draw":"Efficiency Score"]}),e.jsx(R,{}),e.jsx(T,{yAxisId:"current",type:"monotone",dataKey:"current_amp",stroke:u.primary,strokeWidth:2,dot:!1}),e.jsx(T,{yAxisId:"efficiency",type:"monotone",dataKey:"efficiency_score",stroke:u.secondary,strokeWidth:2,dot:!1})]})})]}),e.jsxs("div",{className:"h-48",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"Current Draw by Operating State"}),e.jsx(w,{width:"100%",height:"100%",children:e.jsxs($,{data:[{state:"OFF",avg_current:.3,efficiency:.95},{state:"STANDBY",avg_current:1.2,efficiency:.88},{state:"SPIN",avg_current:3.1,efficiency:.82},{state:"DRILL",avg_current:5.8,efficiency:.75}],children:[e.jsx(C,{strokeDasharray:"3 3"}),e.jsx(S,{dataKey:"state"}),e.jsx(b,{yAxisId:"current",orientation:"left"}),e.jsx(b,{yAxisId:"efficiency",orientation:"right"}),e.jsx(D,{formatter:(t,a)=>[a==="avg_current"?`${t.toFixed(1)}A`:`${(t*100).toFixed(1)}%`,a==="avg_current"?"Avg Current":"Efficiency"]}),e.jsx(R,{}),e.jsx(A,{yAxisId:"current",dataKey:"avg_current",fill:u.primary}),e.jsx(A,{yAxisId:"efficiency",dataKey:"efficiency",fill:u.accent})]})})]})]}),f==="battery"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800",children:"Battery Usage Optimization Insights"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Device"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usage Pattern"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Charging Freq."}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Degradation Rate"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Potential Savings"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.battery_insights.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.device_id}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${t.current_usage_pattern==="efficient"?"bg-green-100 text-green-800":t.current_usage_pattern==="moderate"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.current_usage_pattern})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[t.charging_frequency.toFixed(1),"/day"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[t.battery_degradation_rate.toFixed(1),"%/month"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[t.potential_savings_hours.toFixed(1),"h"]})]},t.device_id))})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700",children:"Recommended Optimization Actions"}),l.battery_insights.map(t=>t.optimization_actions.length>0&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded border-l-4 border-blue-400",children:[e.jsx("div",{className:"font-medium text-blue-900 mb-2",children:t.device_id}),e.jsx("ul",{className:"space-y-1",children:t.optimization_actions.map((a,s)=>e.jsxs("li",{className:"text-sm text-blue-800",children:["• ",a]},s))})]},t.device_id))]})]}),f==="correlation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800",children:"Operational Patterns vs Equipment Health"}),e.jsxs("div",{className:"h-64",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"Pattern Correlation Strength"}),e.jsx(w,{width:"100%",height:"100%",children:e.jsxs($,{data:l.correlations,layout:"horizontal",children:[e.jsx(C,{strokeDasharray:"3 3"}),e.jsx(S,{type:"number",domain:[-1,1]}),e.jsx(b,{dataKey:"pattern_name",type:"category",width:150,tick:{fontSize:10}}),e.jsx(D,{formatter:t=>[`${(t*100).toFixed(0)}%`,"Correlation"]}),e.jsx(A,{dataKey:"correlation_strength",children:l.correlations.map((t,a)=>e.jsx(J,{fill:t.correlation_strength>0?u.secondary:u.danger},`cell-${a}`))})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700",children:"Detailed Correlation Analysis"}),l.correlations.map((t,a)=>e.jsxs("div",{className:`p-4 rounded border-l-4 ${t.health_impact==="positive"?"bg-green-50 border-green-400":t.health_impact==="negative"?"bg-red-50 border-red-400":"bg-gray-50 border-gray-400"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h6",{className:"font-medium text-gray-900",children:t.pattern_name}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded ${t.health_impact==="positive"?"bg-green-100 text-green-800":t.health_impact==="negative"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:t.health_impact}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.frequency," occurrences"]})]})]}),e.jsx("p",{className:"text-sm text-gray-700",children:t.recommendation})]},a))]})]}),f==="insights"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800",children:"Actionable Optimization Insights"}),l.actionable_insights.map((t,a)=>e.jsxs("div",{className:`p-6 rounded-lg border-l-4 ${t.impact_level==="critical"?"bg-red-50 border-red-400":t.impact_level==="high"?"bg-orange-50 border-orange-400":t.impact_level==="medium"?"bg-yellow-50 border-yellow-400":"bg-green-50 border-green-400"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-lg font-medium text-gray-900 mb-1",children:t.title}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:`px-3 py-1 text-sm rounded-full font-medium ${t.impact_level==="critical"?"bg-red-100 text-red-800":t.impact_level==="high"?"bg-orange-100 text-orange-800":t.impact_level==="medium"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:[t.impact_level.toUpperCase()," IMPACT"]}),e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:t.category.toUpperCase()})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Devices Affected"}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:t.devices_affected.length})]})]}),e.jsx("p",{className:"text-gray-700 mb-4",children:t.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"font-medium text-gray-900 mb-2",children:"💰 Potential Benefit"}),e.jsx("p",{className:"text-sm text-gray-700",children:t.potential_benefit})]}),e.jsxs("div",{children:[e.jsx("h6",{className:"font-medium text-gray-900 mb-2",children:"🎯 Affected Equipment"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.devices_affected.map(s=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:s},s))})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h6",{className:"font-medium text-gray-900 mb-2",children:"📋 Action Items"}),e.jsx("ul",{className:"space-y-1",children:t.action_items.map((s,h)=>e.jsxs("li",{className:"text-sm text-gray-700 flex items-start",children:[e.jsx("span",{className:"text-blue-600 mr-2",children:"•"}),s]},h))})]})]},a))]})]})};export{te as default};
